# Grub configuration file generated by Elemental3
#
# !! DO NOT EDIT !!

search --no-floppy --label --set=root {{.Label}}
load_env --file (${root})/grubenv

if test -n "${env_block}"; then
  set env_block="(${root})${env_block}"
  export env_block
  load_env -f "${env_block}"
fi

set default="0"
if test -n "${next_entry}"; then
  set default="${next_entry}"
  set next_entry=
  save_env next_entry
  if test -n "${env_block}"; then
    save_env -f "${env_block}" next_entry
  fi
  set boot_once=true
fi

set menuentry_id_option=""
if test "${feature_menuentry_id}" == "y"; then
  menuentry_id_option="--id"
fi
export menuentry_id_option

if test -n "${prev_saved_entry}"; then
  set saved_entry="${prev_saved_entry}"
  save_env saved_entry
  set prev_saved_entry=
  save_env prev_saved_entry
  set boot_once=true
fi

function savedefault {
  if ! test -n "${boot_once}"; then
    saved_entry="${chosen}"
    if test -n "${env_block}"; then
      save_env -f "${env_block}" saved_entry
    else
      save_env saved_entry
    fi
  fi
}

function load_video {
  if test "${feature_all_video_module}" == "y"; then
    insmod all_video
  else
    insmod efi_gop
    insmod efi_uga
    insmod ieee1275_fb
    insmod vbe
    insmod vga
    insmod video_bochs
    insmod video_cirrus
  fi
}

{{if .SerialConsole}}
# Serial console configuration for cloud environments (AWS, Azure, GCP)
serial --unit=0 --speed=115200 --word=8 --parity=no --stop=1
terminal_input serial console
terminal_output serial console
{{else}}
set font="/grub2/unicode.pf2"
if test "${feature_default_font_path}" == "y"; then
  font="unicode"
fi

if loadfont $font ; then
  if test "${grub_platform}" == "efi"; then
    clear
    echo "Please press 't' to show the boot menu on this console"
  fi
  set gfxmode="auto"
  load_video
  insmod gfxterm
fi
terminal_input console

for i in gfxterm; do
  if test "${use_append}" == "true"; then
     terminal_output --append $i
  elif terminal_output $i; then
     use_append=true;
  fi
done
{{end}}

insmod part_gpt
insmod gfxmenu
insmod png

set theme_path="($root)/grub2/themes/SLE"
if test -d "${theme_path}"; then
  loadfont ${theme_path}/DejaVuSans-Bold14.pf2
  loadfont ${theme_path}/DejaVuSans10.pf2
  loadfont ${theme_path}/DejaVuSans12.pf2
  loadfont ${theme_path}/ascii.pf2
  set theme="${theme_path}/theme.txt"
  export theme
fi

set default_timeout=10
if test -n "${timeout}"; then
  default_timeout=${timeout}
fi

if test "${boot_once}" == "true"; then
  set timeout=0
elif test "${feature_timeout_style}" == "y"; then
  set timeout_style=menu
  set timeout=${default_timeout}
# Fallback normal timeout code in case the timeout_style feature is
# unavailable.
else
  set timeout=${default_timeout}
fi

# Each entry must set display_name, linux, initrd and cmdline
for entry in ${entries}; do
  load_env --file (${root})/loader/entries/${entry}

  menuentry "${display_name}" --id "${entry}" "${linux}" "${initrd}" "${cmdline}" {
    set linux="${2}"
    set initrd="${3}"
    set cmdline="${4}"
    
    echo 'Loading Linux...'
    linux "${linux}" ${cmdline}
    echo 'Loading initial ramdisk ...'
    initrd "${initrd}"
  }
done

if test "${grub_platform}" == "efi"; then
  # On EFI systems we can only have graphics *or* serial, so allow the user
  # to switch between the two
  hiddenentry 'Text mode' --hotkey 't' {
    set textmode=true
    terminal_output console
  }
fi
